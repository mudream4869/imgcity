# Java 呼叫 c++函數

最近課業需要查了一下，並且在Mac上弄出來。

## 第一步

先準備一個`Sample1.java`

```java
public class Sample1
{
    public native void func1();

    public static void main(String[] args)
    {
        Sample1 sample = new Sample1();
        System.load(args[0] + "/libsample.so"); // 絕對路徑
        sample.func1();
        return;
    }
}
```

然後

```bash
$ javac Sample1.java
$ javah Sample1
```

## 第二步

這時會發現除了`Sample1.class`以外，還有`Sample1.h`

打開後可以看到

```cpp
/* DO NOT EDIT THIS FILE - it is machine generated */
#include <jni.h>
/* Header for class Sample1 */

#ifndef _Included_Sample1
#define _Included_Sample1
#ifdef __cplusplus
extern "C" {
#endif
/*
 * Class:     Sample1
 * Method:    func1
 * Signature: ()V
 */
JNIEXPORT void JNICALL Java_Sample1_func1
  (JNIEnv *, jobject);

#ifdef __cplusplus
}
#endif
#endif
```

這些是`javah`自動依照Sample1.java生成的，原因是因為有一個`native function`

所以這時可以準備一個對應的`cpp`檔案和`func1`

```cpp
#include <cstdio>
#include "Sample1.h"

JNIEXPORT void JNICALL Java_Sample1_func1(JNIEnv* jenv, jobject jobj){
    printf("ok\n");
    return;
}
```

## 第三步

這時後就要準備把`Sample1.cpp`做成`libsample.so`啦

```bash
$ g++ Sample1.cpp -I"/System/Library/Frameworks/JavaVM.framework/Headers" -c -fPIC
$ g++ Sample1.o -shared -o libsample.so
```

### 收工

```bash
$ java Sample1 `pwd`
```